@{
    ViewData["Title"] = "Descriptive Analysis";
    Layout = "~/Views/Shared/_LayoutLoggedin.cshtml";
}


<style>
    * {
        margin: 0;
        padding: 0;
        font-family: sans-serif;
    }

    .chartMenu {
        width: auto;
        height: auto;
        padding:20px;
        background: #69cc00;
        text-align: center;
        color: white;
    }

        .chartMenu p {
            padding: 10px;
            font-size: 30px;
        }

    .chartCard {
        width: auto;
        height: auto;
        padding: 20px;
        background: #e6ffcc;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .chartBox {
        width: 1000px;
        padding: 20px;
        border-radius: 20px;
        border: solid 3px #4f9900;
        background: white;
    }

    .chartBox2 {
        width: 1000px;
        padding: 20px;
        border-radius: 20px;
        border: solid 3px #4f9900;
        background: white;
    }

    .chartjs-table, th, td {
        border-collapse: collapse;
        border: 1px solid green;
        padding: 10px;
    }

    .chartjs-thead {
        font-weight: bold;
    }

    .chartjs-tbody {
        text-align: center;
    }

</style>

<!-- For CSV To ChartJS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="back-button" style="margin-bottom:20px">
    <a class="notificationback-link btn btn-outline-success p-2 mt-5" href="ReportsPage" type="button">Back</a>
    <a class="notificationback-link btn btn-outline-success p-2 mt-5" onClick="window.print()" style="width:20%">Print/Save File</a>
</div>

<div class="chartMenu">
    <p>SUMMARY OF NET PROFIT: DESCRIPTIVE ANALYSIS</p>
</div>

<!-- INPUT DB SHEET LINK-->
<div class="container" style="padding:40px">
    <div class="card">
        <div class="card-header"><b>Input SHEETDB API URL (CSV FILE)</b></div>
        <div style="padding:10px">Create new Google Spreadsheet using this template: <a class="card-link" href="https://docs.google.com/spreadsheets/d/1-mp_WubDktjqvG3nSjnc07whRNG8yx6vAliLGjwxsMg/edit#gid=0" target="_blank">Descriptive Template</a></div>
        <div style="padding:10px">Logged in to Convert Google Spreadsheet link to SheetDB API (CSV): <a class="card-link" href="https://sheetdb.io/apis" target="_blank">SheetDB API</a></div>
        <div class="card-body" style="margin: 0 auto;margin-left: auto;margin-right: auto;">
            <input type="text" placeholder="Paste SheetDB API Url Here..." id="myInput" size="50">
            <button class="btn btn-outline-success" onclick="plotcharts()">Plot Charts</button>
        </div>
    </div>
</div>


<!-- Visual Charts-->
<div class="chartCard">
    <div class="chartBox">
        <div>Bar Graph: UNIT SOLD PER PRODUCT</div>
        <canvas id="barchart"></canvas>
    </div>
</div>

<div class="chartCard">
    <div class="chartBox">
        <div>Line Graph: GROSS, PROFIT, UNIT SOLD</div>
        <canvas id="linechart"></canvas>
    </div>
</div>


<script type="text/javascript">
    function plotcharts() {
        var inputVal = document.getElementById("myInput").value;
        var apiUrl = inputVal;
        var product = []
        var unit = [];
        var gross = [];
        var net = [];
        var bgcolor = [
            'rgba(255, 26, 104, 0.2)',
            'rgba(54, 162, 235, 0.2)',
            'rgba(255, 206, 86, 0.2)',
            'rgba(75, 192, 192, 0.2)',
            'rgba(153, 102, 255, 0.2)',
            'rgba(255, 159, 64, 0.2)',
            'rgba(0, 0, 0, 0.2)'
        ];

        var bordercolor = [
            'rgba(255, 26, 104, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(153, 102, 255, 1)',
            'rgba(255, 159, 64, 1)',
            'rgba(0, 0, 0, 1)'
        ];



        fetch(apiUrl).then(response => {
            return response.json();
        }).then(data => {
            for (let i = 0; i < data.length; i++) {
                product.push(data[i]['Product']);
                unit.push(parseInt(data[i]['Unit Sold']));
                gross.push(data[i]['Gross Sales']);
                net.push(data[i]['Net Profit']);
            }
            //For Bar chart
            dataset = addData2('Unit Sold', unit, bgcolor, bordercolor);
            drawchart2(dataset, product, 'bar');

            //For Line chart
            dataset = addData('Unit Sold', unit, bgcolor, bordercolor, 'Gross Sales', gross, bgcolor, bordercolor, 'Net Profit', net, bgcolor, bordercolor)
            drawchart(dataset, product, 'line');

        }).catch(err => {
            console.log(err);
        });

    }
    function addData(title, Data, bgcolor, bordercolor, title2, Data2, bgcolor2, bordercolor2, title3, Data3, bgcolor3, bordercolor3) {
        return [{
            label: title,
            data: Data,
            backgroundColor: bgcolor,
            borderColor: bordercolor,
            borderWidth: 1.5
        },
        {
            label: title2,
            data: Data2,
            backgroundColor: bgcolor2,
            borderColor: bordercolor2,
            borderWidth: 1.5
        },
        {
            label: title3,
            data: Data3,
            backgroundColor: bgcolor3,
            borderColor: bordercolor3,
            borderWidth: 1.5
        }];
    }

    function drawchart(dataset, Labels, type) {
        const ctx = document.getElementById(type + 'chart').getContext('2d');
        const myChart = new Chart(ctx, {
            type: type,
            data: {
                labels: Labels,
                datasets: dataset
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                }
            }
        });
    }

    function addData2(title, Data, bgcolor, bordercolor, title2, Data2, bgcolor2, bordercolor2) {
        return [{
            label: title,
            data: Data,
            backgroundColor: bgcolor,
            borderColor: bordercolor,
            borderWidth: 1.5,
        }];
    }

    function drawchart2(dataset, Labels, type) {
        const ctx = document.getElementById(type + 'chart').getContext('2d');
        const myChart = new Chart(ctx, {
            type: type,
            data: {
                labels: Labels,
                datasets: dataset
            },
            options: {
                indexAxis: 'y',
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

</script>

<script>
    function printFunction() {
        window.print();
    }
</script>